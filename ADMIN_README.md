# 管理员模块使用说明

## 概述

股票监控系统现已添加管理员模块，管理员可以查看所有用户信息并删除用户账号。

## 管理员账号

- **邮箱**: moxuy
- **密码**: Ging9597
- **角色**: admin

## 功能特性

### 1. 用户管理
- 查看所有注册用户信息
- 显示用户监控数量统计
- 查看用户注册时间
- 区分管理员和普通用户

### 2. 账号删除
- 删除普通用户账号
- 防止删除管理员账号
- 防止管理员删除自己
- 级联删除用户相关数据（监控设置、账户关联等）

### 3. 权限控制
- 只有管理员可以访问管理面板
- 普通用户无法看到管理功能
- API端点进行权限验证

## 安装和设置

### 1. 运行管理员设置脚本

```bash
npm run setup-admin
```

此脚本将：
- 在User表中添加role字段
- 创建管理员账号（moxuy/Ging9597）
- 为现有用户设置默认角色（user）

### 2. 验证安装

登录管理员账号后，您应该能看到：
- 主页面底部显示"管理员面板"
- 可以查看所有用户列表
- 可以删除普通用户账号

## 使用方法

### 1. 登录管理员账号
使用邮箱 `moxuy` 和密码 `Ging9597` 登录系统

### 2. 访问管理面板
登录后，管理员面板会自动显示在主页面底部

### 3. 查看用户信息
- 用户总数统计
- 每个用户的详细信息
- 监控数量统计
- 注册时间

### 4. 删除用户
1. 在用户列表中找到要删除的用户
2. 点击"删除"按钮
3. 确认删除操作
4. 系统将永久删除该用户的所有数据

## 安全特性

### 1. 权限验证
- 所有管理API都验证管理员权限
- 前端组件根据用户角色显示/隐藏

### 2. 数据保护
- 管理员不能删除自己的账号
- 管理员账号不能被删除
- 删除操作使用数据库事务确保数据一致性

### 3. 审计日志
- 删除操作记录在服务器日志中
- 可以追踪所有管理操作

## API端点

### GET /api/admin/users
获取所有用户列表（需要管理员权限）

### DELETE /api/admin/delete-user
删除指定用户（需要管理员权限）

## 数据库结构

### User表新增字段
```sql
ALTER TABLE "User" ADD COLUMN "role" VARCHAR(10) DEFAULT 'user';
```

### 角色值
- `user`: 普通用户（默认）
- `admin`: 管理员

## 注意事项

1. **数据安全**: 删除用户操作不可撤销，请谨慎操作
2. **权限管理**: 只有指定的管理员账号可以访问管理功能
3. **数据完整性**: 删除用户时会同时删除相关的监控设置和账户信息
4. **备份建议**: 建议在删除重要用户前备份相关数据

## 故障排除

### 1. 管理员面板不显示
- 确认已登录管理员账号
- 检查用户角色是否为admin
- 运行 `npm run setup-admin` 重新设置

### 2. 权限不足错误
- 确认当前账号具有admin角色
- 检查数据库中的role字段值

### 3. 删除用户失败
- 检查用户是否存在
- 确认不是管理员账号
- 查看服务器错误日志

## 技术支持

如遇到问题，请检查：
1. 数据库连接是否正常
2. 环境变量是否正确设置
3. 用户角色是否正确设置
4. 服务器日志中的错误信息
